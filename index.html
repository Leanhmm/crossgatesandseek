<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hide and Seek: Crossgates Edition</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      background-color: #f0f0f0;
    }
    .card {
      background: white;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 10px;
      margin: 10px;
      display: inline-block;
      width: 250px;
    }
    .card-title {
      font-weight: bold;
    }
    .card-description {
      font-size: 14px;
      margin: 8px 0;
    }
    .button {
      margin: 10px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }
    #questionDisplay, #timerDisplay {
      margin-top: 20px;
      font-size: 18px;
      font-weight: bold;
    }
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
</head>
<body>
  <div id="main">
    <h1>Hide and Seek: Crossgates Edition</h1>
    <button class="button" onclick="goToRole('hider')">I'm a Hider</button>
    <button class="button" onclick="goToRole('seeker')">I'm a Seeker</button>
    <button class="button" onclick="resetGame()">Reset Game</button>
  </div>

  <div id="hiderPage" style="display: none;">
    <h2>Hider Mode</h2>
    <button class="button" onclick="drawCard()">Draw 1 Card</button>
    <button class="button" onclick="drawThreeChooseOne()">Draw 3 Cards, Choose 1</button>
    <button class="button" onclick="startGame()">Start Game</button>
    <div id="timerDisplay"></div>
    <h3>Your Hand:</h3>
    <div id="hand"></div>
  </div>

  <div id="seekerPage" style="display: none;">
    <h2>Seeker Mode</h2>
    <button class="button" onclick="askQuestion(0)">Question 1</button>
    <button class="button" onclick="askQuestion(1)">Question 2</button>
    <button class="button" onclick="askQuestion(2)">Question 3</button>
    <button class="button" onclick="askQuestion(3)">Question 4</button>
    <div id="questionDisplay"></div>
    <div id="timerDisplay"></div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBloy0c-h2PXGMJrsY83w9e3wsG9W7lOf8",
      authDomain: "crossgatesandseek.firebaseapp.com",
      projectId: "crossgatesandseek",
      storageBucket: "crossgatesandseek.firebasestorage.app",
      messagingSenderId: "206267305832",
      appId: "1:206267305832:web:2468181e03cf53a30790dd",
      measurementId: "G-WJB3HM0GNP"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let hand = [];
    const allCards = ["Curse of The Animal Love",
      "Curse of The Bestest Builder",
      "Curse of The Middle School Boy",
      "Curse of The Prettiest Princess",
      "Curse of The Overflowing Chalice",
      "Curse of The Mediocre Travel Agent",
      "Curse of The Bargain Hunter",
      "Curse of The Disabled",
      "Curse of The Toilet Troll",
      "Curse of The Jammed Door",
      "Curse of The Impressionable Consumer",
      "Curse of The Right Turn",
      "Curse of The New York Times",
      "Curse of The Spotty Memory",
      "Curse of The Drained Brain",
      "Curse of The Ransom Note",
      "Curse of The Sniff"]; // Same as before
    const cardDescriptions = {"Curse of The Animal Love": "Seekers must take a photo of them petting an animal",
      "Curse of The Bestest Builder": "Seekers must purchase and complete a lego set, and send a photo of the lego set to the seekers before continueing their search",
      "Curse of The Middle School Boy": "Seekers must successfully flip a water bottle, having it land right side up, three times consecutively before continuing their search",
      "Curse of The Prettiest Princess": "Before asking another question, one team member must try on a very pretty clothing item and send a photo to the other team",
      "Curse of The Overflowing Chalice": "For the next three questions, you may draw (not keep) an additional card when drawing from the hider deck",
      "Curse of The Mediocre Travel Agent": "Give unsolicited directions to the next person you see.",
      "Curse of The Bargain Hunter": "Take a photo of any item for sale. The Seekers must take a photo of the same item (may be a different brand) being sold at a cheaper price before continuing",
      "Curse of The Disabled": "Seekers may not use escalators for the next ten minutes",
      "Curse of The Toilet Troll": "The seekers must ask their next question from inside a bathroom stall",
      "Curse of The Jammed Door": "For the next 15 minutes, whenever the seeker(s) want to pass through a doorway/entrance into a  business they must first flip a coin. If the coin does not land on heads, they cannot pass through the entry",
      "Curse of The Impressionable Consumer": "Seekers must take a photo of a product that they saw an advertisement for before asking another question. This advertisement may be found on your phone, but it may not be found via a search",
      "Curse of The Right Turn": "For the next 5 minutes the seekers can only enter buisnesses that are on the right side of them (they must only walk on the right side of the hall and may not cross to the other side of a hall until they hit JCPenny or Macys",
      "Curse of The New York Times": "The seekers must solve the wordle before answering another question. If the wordle has already been solved, they must solve the mini",
      "Curse of The Spotty Memory": "For the rest of the run, one random category of questions will be disabled at all times. After this curse is played seeker(s) must roll a die to determine the category of questions to be disabled. The catergy remain disabled until the next question is asked at which point a die is rolled again to choose an e category. The same category can be disabled multiple times in a row",
      "Curse of The Drained Brain": "Choose three questions in different categories. The seekers cannot ask those questions for the rest of the run",
      "Curse of The Ransom Note": "The next question that the seekers ask must be composed using a compilation of photos of the words found in printed material throughout the mall",  
      "Curse of The Sniff": "Before continueing, the seekers must go to bath and body works and, given two options, one of the seekers must blindly guess the name of the scent their teammate presents them with"}; // Same as before
    let countdownStarted = false;
    let timerInterval;

    function goToRole(role) {
      document.getElementById('main').style.display = 'none';
      if (role === 'hider') {
        document.getElementById('hiderPage').style.display = 'block';
        db.ref('hand').on('value', snapshot => {
          hand = snapshot.val() || [];
          renderHand();
        });
        db.ref('gameStartTime').once('value').then(snapshot => {
          const startTime = snapshot.val();
          if (startTime) startTimer(startTime);
        });
      } else if (role === 'seeker') {
        document.getElementById('seekerPage').style.display = 'block';
        db.ref('usedCard').on('value', snapshot => {
          const data = snapshot.val();
          if (data) alert(`The Hiders used a card: ${data.card}`);
        });
        db.ref('gameStartTime').on('value', snapshot => {
          const startTime = snapshot.val();
          if (startTime) startTimer(startTime);
        });
      }
    }

    function startGame() {
      const startTime = Date.now();
      db.ref('gameStartTime').set(startTime);
      startTimer(startTime);
    }

    function resetGame() {
      db.ref().set({});
      hand = [];
      renderHand();
      clearInterval(timerInterval);
      document.querySelectorAll('#timerDisplay').forEach(el => el.innerText = '');
      document.getElementById('main').style.display = 'block';
      document.getElementById('hiderPage').style.display = 'none';
      document.getElementById('seekerPage').style.display = 'none';
    }

    function startTimer(startTime) {
      if (countdownStarted) return;
      countdownStarted = true;
      clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        const now = Date.now();
        const elapsed = now - startTime;
        const countdownLimit = 10 * 60 * 1000;
        let text = elapsed < countdownLimit ? `Countdown: ${formatTime(countdownLimit - elapsed)}` : `Time: ${formatTime(elapsed - countdownLimit)}`;
        document.querySelectorAll('#timerDisplay').forEach(el => el.innerText = text);
      }, 1000);
    }

    function formatTime(ms) {
      const totalSeconds = Math.floor(ms / 1000);
      const minutes = Math.floor(totalSeconds / 60);
      const seconds = totalSeconds % 60;
      return `${minutes}:${seconds.toString().padStart(2, '0')}`;
    }

    function drawCard() {
      const card = allCards[Math.floor(Math.random() * allCards.length)];
      hand.push(card);
      db.ref('hand').set(hand);
      renderHand();
    }

    function drawThreeChooseOne() {
      const cards = [allCards[0], allCards[1], allCards[0]];
      const chooser = document.createElement('div');
      chooser.innerHTML = '<h3>Choose one card:</h3>';
      cards.forEach(card => {
        const btn = document.createElement('button');
        btn.innerText = card;
        btn.className = 'button';
        btn.onclick = () => {
          hand.push(card);
          db.ref('hand').set(hand);
          renderHand();
          chooser.remove();
        };
        chooser.appendChild(btn);
      });
      document.body.appendChild(chooser);
    }

    function renderHand() {
      const handDiv = document.getElementById('hand');
      handDiv.innerHTML = '';
      hand.forEach((card, index) => {
        const cardDiv = document.createElement('div');
        cardDiv.className = 'card';
        cardDiv.innerHTML = `<div class='card-title'>${card}</div><div class='card-description'>${cardDescriptions[card] || 'No description'}</div>`;
        const useBtn = document.createElement('button');
        useBtn.className = 'button';
        useBtn.innerText = 'Use';
        useBtn.onclick = () => useCard(index);
        cardDiv.appendChild(useBtn);
        handDiv.appendChild(cardDiv);
      });
    }

    function useCard(index) {
      const cardUsed = hand[index];
      alert(`You used: ${cardUsed}`);
      hand.splice(index, 1);
      db.ref('hand').set(hand);
      renderHand();
      db.ref('usedCard').set({card: cardUsed, timestamp: Date.now()});
    }

    function askQuestion(index) {
      const templates = ["Is your nearest ___ the same as my nearest ___?",
      "Notify the hiders that you are starting a thermometer. Once they respond, you have 30 seconds to move. The Hiders must then state if you are hotter or colder.",
      "Out of all the ___ places within five stores of the seekers, which are the hiders closest to?",
      "Take a photo of ___"];
      const banks = [["Jewelry Store", "Bathroom", "Shoe Store", "Escalator", "Entertainment Establishment", "Mall Entrance"],
      [], ["clothing", "food"],
      ["something pink", "a mannequin limb", "a wall", "a sale sign", "a hanger", "your teammate","the thing closest to you"]];
      let filled = templates[index];
      if (filled.includes("___")) {
        const word = banks[index][Math.floor(Math.random() * banks[index].length)];
        filled = filled.replace(/___/g, word);
      }
      document.getElementById('questionDisplay').innerText = filled;
    }
  </script>
</body>
</html>
