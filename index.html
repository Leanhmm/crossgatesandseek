<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hide and Seek: Crossgates Edition</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      background-color: #f0f0f0;
    }
    .card {
      background: white;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 10px;
      margin: 10px;
      display: inline-block;
      width: 250px;
    }
    .card-title {
      font-weight: bold;
    }
    .card-description {
      font-size: 14px;
      margin: 8px 0;
    }
    .button {
      margin: 10px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }
    #questionDisplay, #timerDisplay {
      margin-top: 20px;
      font-size: 18px;
      font-weight: bold;
    }
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
</head>
<body>
  <div id="main">
    <h1>Hide and Seek: Crossgates Edition</h1>
    <button class="button" onclick="goToRole('hider')">I'm a Hider</button>
    <button class="button" onclick="goToRole('seeker')">I'm a Seeker</button>
  </div>

  <div id="hiderPage" style="display: none;">
    <h2>Hider Mode</h2>
    <button class="button" onclick="drawCard()">Draw 1 Card</button>
    <button class="button" onclick="drawThreeChooseOne()">Draw 3 Cards, Choose 1</button>
    <button class="button" onclick="startGame()">Start Game</button>
    <div id="timerDisplay"></div>
    <h3>Your Hand:</h3>
    <div id="hand"></div>
  </div>

  <div id="seekerPage" style="display: none;">
    <h2>Seeker Mode</h2>
    <button class="button" onclick="askQuestion(0)">Question 1</button>
    <button class="button" onclick="askQuestion(1)">Question 2</button>
    <button class="button" onclick="askQuestion(2)">Question 3</button>
    <button class="button" onclick="askQuestion(3)">Question 4</button>
    <div id="questionDisplay"></div>
    <div id="timerDisplay"></div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBloy0c-h2PXGMJrsY83w9e3wsG9W7lOf8",
      authDomain: "crossgatesandseek.firebaseapp.com",
      projectId: "crossgatesandseek",
      storageBucket: "crossgatesandseek.firebasestorage.app",
      messagingSenderId: "206267305832",
      appId: "1:206267305832:web:2468181e03cf53a30790dd",
      measurementId: "G-WJB3HM0GNP"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const hand = [];
    const allCards = ["Curse of The Animal Love", "Curse of The Bestest Builder"];
    const cardDescriptions = {"Curse of The Animal Love": "Seekers must take a photo of them petting an animal", "Curse of The Bestest Builder": "Seekers must build something"};
    let countdownStarted = false;
    let timerInterval;

    function goToRole(role) {
      document.getElementById('main').style.display = 'none';
      if (role === 'hider') {
        document.getElementById('hiderPage').style.display = 'block';
      } else if (role === 'seeker') {
        document.getElementById('seekerPage').style.display = 'block';
        db.ref('usedCard').on('value', snapshot => {
          const data = snapshot.val();
          if (data) alert(`The Hiders used a card: ${data.card}`);
        });
        db.ref('gameStartTime').on('value', snapshot => {
          const startTime = snapshot.val();
          if (startTime) startTimer(startTime);
        });
      }
    }

    function startGame() {
      const startTime = Date.now();
      db.ref('gameStartTime').set(startTime);
      startTimer(startTime);
    }

    function startTimer(startTime) {
      if (countdownStarted) return;
      countdownStarted = true;
      clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        const now = Date.now();
        const elapsed = now - startTime;
        const countdownLimit = 12 * 60 * 1000;
        let text = elapsed < countdownLimit ? `Countdown: ${formatTime(countdownLimit - elapsed)}` : `Overtime: ${formatTime(elapsed - countdownLimit)}`;
        document.querySelectorAll('#timerDisplay').forEach(el => el.innerText = text);
      }, 1000);
    }

    function formatTime(ms) {
      const totalSeconds = Math.floor(ms / 1000);
      const minutes = Math.floor(totalSeconds / 60);
      const seconds = totalSeconds % 60;
      return `${minutes}:${seconds.toString().padStart(2, '0')}`;
    }

    function drawCard() {
      const card = allCards[Math.floor(Math.random() * allCards.length)];
      hand.push(card);
      renderHand();
    }

    function drawThreeChooseOne() {
      const cards = [allCards[0], allCards[1], allCards[0]];
      const chooser = document.createElement('div');
      chooser.innerHTML = '<h3>Choose one card:</h3>';
      cards.forEach(card => {
        const btn = document.createElement('button');
        btn.innerText = card;
        btn.className = 'button';
        btn.onclick = () => {
          hand.push(card);
          renderHand();
          chooser.remove();
        };
        chooser.appendChild(btn);
      });
      document.body.appendChild(chooser);
    }

    function renderHand() {
      const handDiv = document.getElementById('hand');
      handDiv.innerHTML = '';
      hand.forEach((card, index) => {
        const cardDiv = document.createElement('div');
        cardDiv.className = 'card';
        cardDiv.innerHTML = `<div class='card-title'>${card}</div><div class='card-description'>${cardDescriptions[card] || 'No description'}</div>`;
        const useBtn = document.createElement('button');
        useBtn.className = 'button';
        useBtn.innerText = 'Use';
        useBtn.onclick = () => useCard(index);
        cardDiv.appendChild(useBtn);
        handDiv.appendChild(cardDiv);
      });
    }

    function useCard(index) {
      const cardUsed = hand[index];
      alert(`You used: ${cardUsed}`);
      hand.splice(index, 1);
      renderHand();
      db.ref('usedCard').set({card: cardUsed, timestamp: Date.now()});
    }

    function askQuestion(index) {
      const templates = ["Is your nearest ___ the same as mine?", "What store are you near?", "Take a photo of ___"];
      const banks = [["bathroom", "store"], [], ["plant", "poster"]];
      let filled = templates[index];
      if (filled.includes("___")) {
        const word = banks[index][Math.floor(Math.random() * banks[index].length)];
        filled = filled.replace(/___/g, word);
      }
      document.getElementById('questionDisplay').innerText = filled;
    }
  </script>
</body>
</html>
